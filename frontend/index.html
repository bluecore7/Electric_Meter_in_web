<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EnergyFlow | Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css" />
</head>

<body>

    <div class="navbar">
        <h1>⚡ EnergyFlow</h1>
        <div class="nav-actions">
            <button class="secondary" onclick="openDeviceModal()">Register Device</button>
            <button id="logoutBtn" style="display:none" onclick="logout()">Logout</button>
        </div>
    </div>

    <div id="authDiv" class="container">
        <div class="card auth-card">
            <h3>Login / Signup</h3>
            <p style="font-size: 0.9rem; opacity: 0.7; margin-bottom: 20px;">
                Access your real-time energy dashboard.
            </p>
            <input id="email" type="email" placeholder="Email" />
            <input id="password" type="password" placeholder="Password" />
            <div class="auth-actions">
                <button onclick="signup()">Sign Up</button>
                <button onclick="login()" class="secondary">Login</button>
            </div>
        </div>
    </div>

    <div id="dashboardDiv" class="container" style="display:none">

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h3 style="margin:0">Registered Devices</h3>
                <span style="font-size: 11px; opacity: 0.6;">Auto-refreshing</span>
            </div>
            <div id="deviceList">
                <p style="opacity:0.5; font-size: 12px;">Connecting...</p>
            </div>
        </div>

        <div class="grid-2">
            <div class="card">
                <h3>Voltage (V)</h3>
                <div class="chart-wrapper">
                    <canvas id="voltageChart"></canvas>
                </div>
            </div>
            <div class="card">
                <h3>Power (W)</h3>
                <div class="chart-wrapper">
                    <canvas id="powerChart"></canvas>
                </div>
            </div>
        </div>

        <div class="grid-2">
            <div class="card">
                <h3>Current Consumption</h3>

                <div class="stats-row">
                    <div class="stat-item">
                        <span class="stat-label">Total Reading</span>
                        <span class="stat-value"><span id="totalUnits">0.00</span> kWh</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Since Last Bill</span>
                        <span class="stat-value highlight"><span id="usedUnits">0.00</span> kWh</span>
                    </div>
                </div>

                <div class="amount-box">₹ <span id="amount">0.00</span></div>
                <button id="takeBtn" onclick="takeReading()" style="width: 100%;">Take New Reading</button>
            </div>

            <div class="card">
                <div class="calendar-header">
                    <button onclick="prevMonth()">◀</button>
                    <span id="calendarMonth"></span>
                    <button onclick="nextMonth()">▶</button>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
        </div>
    </div>

    <div id="deviceModal" class="modal">
        <div class="modal-content card">
            <h3>Register New Device</h3>
            <p style="font-size: 12px; margin-bottom: 15px; opacity: 0.7;">Enter Device ID (e.g. ESP001)</p>
            <input id="deviceId" placeholder="e.g. ESP001" />
            <div style="margin-top:20px; display: flex; gap: 10px;">
                <button onclick="registerDevice()" style="flex:1">Register</button>
                <button class="secondary" onclick="closeDeviceModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>

</html>